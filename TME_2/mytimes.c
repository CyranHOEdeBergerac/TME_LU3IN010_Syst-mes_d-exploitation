#include<stdlib.h>
#include<stdio.h>
#include<sys/time.h>
#include<sys/times.h>
#include<time.h>
#include<unistd.h>


void lance_commande(char* commande){
    struct timeval* temps_init = (struct timeval*) malloc(sizeof ( struct  timeval));
    struct timeval* temps_fin = (struct timeval*) malloc(sizeof( struct timeval));
    gettimeofday(temps_init,NULL);

    //Gestion des erreurs de commande
    if(commande == NULL){
        printf("Erreur ! La commande est nulle\n");
        return;
    }
    else if (system(commande) == -1){
        printf("Erreur ! La commande n'est pas valide\n");
        return;
    }

    gettimeofday(temps_fin,NULL);
    printf("Le temps mis par l'exécution de la commande %s est de %.2f secondes\n", commande, difftime(temps_fin->tv_sec,temps_init->tv_sec));

    free(temps_init);
    free(temps_fin);
}

void lance_commande_v2(char* commande){

    

    struct tms* temps = (struct tms*) malloc (sizeof (struct tms));

    clock_t t_init = times(temps);
    
    //Gestion des erreurs de commande
    if(commande == NULL){
        printf("Erreur ! La commande est nulle\n");
        return;
    }
    else if (system(commande) == -1){
        printf("Erreur ! La commande n'est pas valide\n");
        return;
    }

    clock_t t_fin = times(temps);


    long th = sysconf(_SC_CLK_TCK);

    double TT = (double) (t_fin - t_init) / th;
    double TU = (double) temps->tms_utime / th;
    double TS = (double) temps->tms_stime /th;
    double TUF = (double) temps->tms_cutime/th;
    double TSF = (double) temps->tms_cstime/th;
    
    printf("\nStatistiques de %s : \nTemps total : %.6f s\nTemps utilisateur : %.6f s\nTemps systeme : %.6f s\nTemps utilisateur fils : %.6f s\nTemps systeme fils : %.6f s\n",commande,TT,TU,TS,TUF,TSF);

    free(temps);
}



int main(int argc, char* argv[]){
    int i;
    if (argc == 1){
        printf("Vous n'avez pas passé de commande\n");
    }
    else{
        for (i = 1; i < argc; i ++){
            lance_commande(argv[i]);
        }
    }

    return 0;
}