
# TME 6-7

# Mise en œuvre avec un tampon à une seule case

## 1.1 
Il faut utiliser un mécanisme de MUTEX pour assurer la cohérence de nb_recepteurs.


## 1.2

On utilise un tableau de sémaphores pour éviter qu'un des récepteurs, potentiellement trop rapide, revienne prendre la main et bloque des récepteurs plus lents.

C'est l'émetteur qui prévient de la disponibilité de la case.

# Mise en œuvre avec un tampon à plusieurs cases

## 2.1 

Il va nous falloir deux tableaux de sémaphores (barrière), afin de gérer les différentes cases d'émission et s'assurer que tous les récepteurs ont bien lu la donnée.

On va avoir trois variables partagées : 
    * nb, initialisé à 0, protégé par MUTEX_NB.
    * i_e, l'indice de la case du tableau où émettre, protégé par MUTEX_IE
    * i_l, l'indice de la case du tableau où lire, protégé par MUTEX_IL

    for ( i = 0 ; i < NMAX ; i++)
        Tab_EMET[i] = CS(1)
        Tab_RECEPT[i] = CS(0)
    MUTEX_NB = CS (1)
    MUTEX_IE = CS (1)
    MUTEX_IL = CS (1)


## 2.2

emetteur():
    P(MUTEX_IE)
        i_cour = i_e                //On récupère l'indice où on va écrire dans une variable locale 
        i_e = (i_e + 1) % nmax      //On passe à la case suivante pour le prochain émetteur
    V(MUTEX_IE)

    P(EMET[i_cour])                 //Bloqué tant que tous les récepteurs n'ont pas fini de lire
        /* Action de l'émetteur */

        for (i = 0 ; i < NR ; i++)
            V(RECEPT[i])            // On "donne un ticket" à tous les récepteurs


recepteur(int i) :
    P(MUTEX_IL)
        i_cour = i_l            //Inutile ? On ne fait que de consulter la valeur...
    V(MUTEX_IL)
    P(RECEPT[i])                    //Bloque s'il y a un écrivain en train de remplir la case
        /* Action du recepteur */
        P(MUTEX_NB)
            nb++
            if (nb == NR)           //On a fini de lire, on permet à nouveau l'écriture sur la case, 
                nb = 0              
                P(MUTEX_IL)
                    i_l = (i_l + 1) % nmax      //et on fait passer les lecteurs à celle d'après
                V(MUTEX_IL)
                V(EMET[i_cour])
        V(MUTEX_NB)


