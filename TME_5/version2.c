#include<unistd.h>
#include<sys/types.h>
#include<sys/wait.h>
#include<stdio.h>
#include<stdlib.h>
#include<string.h>

int main(){
    char buffer[256];
    char * arguments[256];
    char * cmd;
    int attente;
    const char * separateur = " \n";
    int i;
    while(1) {
        i = 0;
        attente = 1;
        fgets(buffer, 256,stdin);

        /* On va récupérer la commande et les arguments*/
        cmd = strtok(buffer, separateur);
        arguments[i] = cmd;                 //On les conserve dans un tableau d'arguments
        i++;
        if(strcmp(cmd,"quit")==0){
            printf("Au revoir\n");
            exit(0);
        }

        char* strtoken  = strtok(NULL,separateur);
        while(strtoken != NULL ){
            arguments[i] = strtoken;
            i++;
            strtoken  = strtok(NULL,separateur);
        }

        arguments[i] = NULL;        //On met le pointeur NULL après le dernier argument ajouté (y compris le nom de la commande)
        if (strcmp(arguments[i-1],"&")==0){
            attente = 0;
            arguments[i-1] = NULL;          //On ne doit pas prendre le & en compte dans les arguments
        }
        if(fork()==0){
            execvp(cmd,arguments);
            printf("Échec de l'exec\n");
            exit(-1);           //En cas d'échec de l'execl
        }
        else if(attente == 1){      //uniquement le père
            wait(NULL);     //Si la commande ne finit pas par &, on attend
        }
    }
}  